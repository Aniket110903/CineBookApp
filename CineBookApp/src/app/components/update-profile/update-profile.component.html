<div class="back-button-container">
  <button class="btn back-button" (click)="goBack()">
    <i class="fa fa-arrow-left"></i> Back
  </button>
</div>
<div class="user-details-container container p-4 rounded shadow bg-light mt-5">

  <!-- Header with Edit Button -->
  <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
    <h2 class="mb-0 text-teal">👤 Profile Details</h2>
    <div>
      <button class="btn btn-primary edit-btn" (click)="onEdit()" aria-label="Edit user details" title="Edit">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M12.146 0.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-9.5 9.5a.5.5 0 0 1-.233.131l-5 1.5a.5.5 0 0 1-.64-.64l1.5-5a.5.5 0 0 1 .131-.232l9.5-9.5zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 1.586-8.5 8.5-.793 2.646 2.646-.793 8.5-8.5-2.646-2.646z" />
        </svg>
      </button>
    </div>
  </div>

  <!-- User Info Rows -->
  <div class="row g-4">

    <div class="col-md-6">
      <div class="info-box">
        <strong>Name:</strong> <span class="ms-2">{{ user.firstName }} {{ user.lastName }}</span>
      </div>
    </div>

    <div class="col-md-6">
      <div class="info-box">
        <strong>Email:</strong> <span class="ms-2">{{ user.email }}</span>
      </div>
    </div>

    <div class="col-md-6">
      <div class="info-box" [title]="user.address">
        <strong>Address:</strong>
        <span class="ms-2 text-truncate-address">{{ user.address }}</span>
      </div>

    </div>

    <div class="col-md-6">
      <div class="info-box d-flex align-items-center">
        <strong>Reset Code:</strong>
        <span class="ms-2">
          {{ showResetCode ? user.resetCode : '••••' }}
        </span>
        <button class="btn btn-sm btn-link ms-2 p-0 eye-btn" (click)="toggleResetCode()" title="Toggle Reset Code">
          <span *ngIf="!showResetCode">👁️</span>
          <span *ngIf="showResetCode">🙈</span>
        </button>
      </div>
    </div>

    <div class="col-md-6">
      <div class="info-box">
        <strong>Loyalty Points:</strong> <span class="ms-2 text-success fw-bold">🪙 {{ user.loyaltyPoints }}</span>
      </div>
    </div>

    <div class="col-md-6">
      <div class="info-box">
        <strong>Member Since:</strong> <span class="ms-2">{{ user.createdAt | date:'longDate' }}</span>
      </div>
    </div>

  </div>
</div>

<!--<div class="container mt-5" style="max-width: 480px;" *ngIf="editPopUp">
  <div class="card shadow-sm border-primary">
    <div class="card-body p-4">
      <h2 class="card-title mb-4 text-center fw-bold">Update Profile</h2>

      <form #updateForm="ngForm" (ngSubmit)="openPasswordModal(updateForm)" novalidate>-->
<!-- First Name -->
<!--<div class="mb-3">
  <label for="firstName" class="form-label">First Name</label>
  <input type="text"
         id="firstName"
         name="firstName"
         class="form-control"
         [(ngModel)]="firstName"
         required
         #firstNameModel="ngModel"
         [class.is-invalid]="firstNameModel.invalid && (firstNameModel.dirty || firstNameModel.touched)"
         [class.is-valid]="firstNameModel.valid && (firstNameModel.dirty || firstNameModel.touched)" />
  <div *ngIf="firstNameModel.invalid && (firstNameModel.dirty || firstNameModel.touched)" class="invalid-feedback">
    First name is required.
  </div>
</div>-->
<!-- Last Name -->
<!--<div class="mb-3">
  <label for="lastName" class="form-label">Last Name</label>
  <input type="text"
         id="lastName"
         name="lastName"
         class="form-control"
         [(ngModel)]="lastName"
         required
         #lastNameModel="ngModel"
         [class.is-invalid]="lastNameModel.invalid && (lastNameModel.dirty || lastNameModel.touched)"
         [class.is-valid]="lastNameModel.valid && (lastNameModel.dirty || lastNameModel.touched)" />
  <div *ngIf="lastNameModel.invalid && (lastNameModel.dirty || lastNameModel.touched)" class="invalid-feedback">
    Last name is required.
  </div>
</div>-->
<!-- Email -->
<!--<div class="mb-3">
  <label for="email" class="form-label">New Email Address</label>
  <input type="email"
         id="email"
         name="email"
         class="form-control"
         [(ngModel)]="email"
         required
         email
         #emailModel="ngModel"
         [class.is-invalid]="emailModel.invalid && (emailModel.dirty || emailModel.touched)"
         [class.is-valid]="emailModel.valid && (emailModel.dirty || emailModel.touched)" />
  <div *ngIf="emailModel.invalid && (emailModel.dirty || emailModel.touched)" class="invalid-feedback">
    <div *ngIf="emailModel.errors?.['required']">Email is required.</div>
    <div *ngIf="emailModel.errors?.['email']">Invalid email format.</div>
  </div>
</div>-->
<!-- Address -->
<!--<div class="mb-3">
  <label for="address" class="form-label">Address</label>
  <input type="text"
         id="address"
         name="address"
         class="form-control"
         [(ngModel)]="address"
         required
         #addressModel="ngModel"
         [class.is-invalid]="addressModel.invalid && (addressModel.dirty || addressModel.touched)"
         [class.is-valid]="addressModel.valid && (addressModel.dirty || addressModel.touched)" />
  <div *ngIf="addressModel.invalid && (addressModel.dirty || addressModel.touched)" class="invalid-feedback">
    Address is required.
  </div>
</div>-->
<!-- Error Message -->
<!--<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>-->
<!-- Submit -->
<!--<button type="submit" class="btn btn-primary w-100" [disabled]="updateForm.invalid || isUpdating">
        Edit
      </button>
    </form>
  </div>
</div>-->
<div class="modal fade " id="updateProfileModal"
     [class.show]="editPopUp" [style.display]="editPopUp ? 'block' : 'none'"
     tabindex="-1"
     aria-labelledby="updateProfileModalLabel"
     aria-hidden="true"
     data-bs-backdrop="static"
     data-bs-keyboard="false">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content  shadow-sm">
      <div class="modal-header bg-teal text-light">
        <h5 class="modal-title fw-bold text-center w-100" id="updateProfileModalLabel">
          Update Profile
        </h5>
      </div>
      <div class="modal-body p-4">
        <form #updateForm="ngForm" (ngSubmit)="openPasswordModal(updateForm)" novalidate>
          <!-- First Name -->
          <div class="mb-3">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text"
                   id="firstName"
                   name="firstName"
                   class="form-control"
                   [(ngModel)]="firstName"
                   required
                   #firstNameModel="ngModel"
                   [class.is-invalid]="firstNameModel.invalid && (firstNameModel.dirty || firstNameModel.touched)"
                   [class.is-valid]="firstNameModel.valid && (firstNameModel.dirty || firstNameModel.touched)" />
            <div *ngIf="firstNameModel.invalid && (firstNameModel.dirty || firstNameModel.touched)" class="invalid-feedback">
              First name is required.
            </div>
          </div>

          <!-- Last Name -->
          <div class="mb-3">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text"
                   id="lastName"
                   name="lastName"
                   class="form-control"
                   [(ngModel)]="lastName"
                   required
                   #lastNameModel="ngModel"
                   [class.is-invalid]="lastNameModel.invalid && (lastNameModel.dirty || lastNameModel.touched)"
                   [class.is-valid]="lastNameModel.valid && (lastNameModel.dirty || lastNameModel.touched)" />
            <div *ngIf="lastNameModel.invalid && (lastNameModel.dirty || lastNameModel.touched)" class="invalid-feedback">
              Last name is required.
            </div>
          </div>

          <!-- Email -->
          <div class="mb-3">
            <label for="email" class="form-label">New Email Address</label>
            <input type="email"
                   id="email"
                   name="email"
                   class="form-control"
                   [(ngModel)]="email"
                   required
                   email
                   #emailModel="ngModel"
                   [class.is-invalid]="emailModel.invalid && (emailModel.dirty || emailModel.touched)"
                   [class.is-valid]="emailModel.valid && (emailModel.dirty || emailModel.touched)" />
            <div *ngIf="emailModel.invalid && (emailModel.dirty || emailModel.touched)" class="invalid-feedback">
              <div *ngIf="emailModel.errors?.['required']">Email is required.</div>
              <div *ngIf="emailModel.errors?.['email']">Invalid email format.</div>
            </div>
          </div>

          <!-- Address -->
          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input type="text"
                   id="address"
                   name="address"
                   class="form-control"
                   [(ngModel)]="address"
                   required
                   #addressModel="ngModel"
                   [class.is-invalid]="addressModel.invalid && (addressModel.dirty || addressModel.touched)"
                   [class.is-valid]="addressModel.valid && (addressModel.dirty || addressModel.touched)" />
            <div *ngIf="addressModel.invalid && (addressModel.dirty || addressModel.touched)" class="invalid-feedback">
              Address is required.
            </div>
          </div>

          <!-- Error Message -->
          <!--<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>-->
          <!-- Submit -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeEditPopup()">Cancel</button>
            <button type="submit" class="btn btn-primary " [disabled]="updateForm.invalid || isUpdating">
              Edit
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div>
  <!-- Modal: Confirm Password -->
  <div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content ">
        <div class="modal-header bg-teal">
          <h5 class="modal-title">Confirm Password</h5>
          <button type="button" class="btn-close" (click)="closePasswordModal()"></button>
        </div>
        <form #passwordForm="ngForm" (ngSubmit)="confirmUpdate()">
          <div class="modal-body">
            <label for="confirmPassword" class="form-label">Enter Password to Confirm</label>
            <input type="password"
                   id="confirmPassword"
                   class="form-control"
                   [(ngModel)]="confirmPassword"
                   name="confirmPassword"
                   required
                   #password="ngModel" />
            <div *ngIf="password.invalid && (password.dirty || password.touched)" class="text-danger">
              Password is required.
            </div>

          </div>
          <!--<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>-->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closePasswordModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid"> Confirm</button>
          </div>
        </form>
      </div>
    </div>
  </div>
